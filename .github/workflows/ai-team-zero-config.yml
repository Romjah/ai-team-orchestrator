name: ğŸ¤– AI Team Zero-Config

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]
  workflow_dispatch:
    inputs:
      task_description:
        description: 'Description de la tÃ¢che Ã  automatiser'
        required: true
        type: string

jobs:
  ai-coding:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ” Analyze Task
      id: analyze
      run: python3 .github/scripts/zero_config_generator.py
      env:
        ACTION: 'analyze'
        GITHUB_EVENT_NAME: ${{ github.event_name }}
        ISSUE_TITLE: ${{ github.event.issue.title }}
        ISSUE_BODY: ${{ github.event.issue.body }}
        COMMENT_BODY: ${{ github.event.comment.body }}
        MANUAL_TASK: ${{ github.event.inputs.task_description }}

    - name: ğŸ¤– Generate Code
      id: generate
      run: python3 .github/scripts/zero_config_generator.py
      env:
        ACTION: 'generate'
        TASK: ${{ steps.analyze.outputs.task }}
        AGENT: ${{ steps.analyze.outputs.agent }}
        TASK_TYPE: ${{ steps.analyze.outputs.task_type }}

    - name: ğŸ’» Apply Generated Code
      id: apply
      run: python3 .github/scripts/zero_config_generator.py
      env:
        ACTION: 'apply'

    - name: ğŸ“ Create Pull Request
      if: steps.apply.outputs.changes_made == 'true'
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          ğŸ¤– Code automatique gÃ©nÃ©rÃ© par AI Team
          
          Agent: ${{ steps.analyze.outputs.agent }}
          Type: ${{ steps.analyze.outputs.task_type }}
        title: "ğŸ¤– [AI Team] ${{ steps.analyze.outputs.task_summary }}"
        body: |
          ## ğŸ¤– Pull Request gÃ©nÃ©rÃ©e automatiquement
          
          **Agent IA utilisÃ©:** ${{ steps.analyze.outputs.agent }}
          **Type de tÃ¢che:** ${{ steps.analyze.outputs.task_type }}
          
          ### ğŸ“‹ TÃ¢che demandÃ©e
          ${{ steps.analyze.outputs.task }}
          
          ### ğŸ“ Fichiers crÃ©Ã©s
          ${{ steps.apply.outputs.files_created }}
          
          ### âœ¨ FonctionnalitÃ©s
          - Code gÃ©nÃ©rÃ© automatiquement par IA
          - Tests inclus selon le type de tÃ¢che
          - PrÃªt Ã  l'emploi
          
          ---
          *GÃ©nÃ©rÃ© par AI Team Orchestrator - Zero Config*
          
          **ğŸ¯ Aucune configuration manuelle requise !**
        branch: ai-team/auto-${{ github.run_number }}
        delete-branch: true

    - name: ğŸ“Š Update Issue Status
      if: github.event_name == 'issues' || github.event_name == 'issue_comment'
      uses: actions/github-script@v7
      with:
        script: |
          const issueNumber = context.issue.number;
          const success = '${{ steps.apply.outputs.changes_made }}' === 'true';
          
          const comment = success ? 
            `ğŸ‰ **AI Team a traitÃ© votre demande !**
            
            âœ… **Pull Request crÃ©Ã©e automatiquement**
            ğŸ¤– **Agent utilisÃ©:** ${{ steps.analyze.outputs.agent }}
            ğŸ“ **Fichiers crÃ©Ã©s:** ${{ steps.apply.outputs.files_created }}
            
            **ğŸ”¥ Aucune configuration manuelle nÃ©cessaire !**
            
            La PR contient du code prÃªt Ã  l'emploi gÃ©nÃ©rÃ© par notre Ã©quipe d'IA.` :
            `âš ï¸ **Aucun code gÃ©nÃ©rÃ©**
            
            L'IA n'a pas pu traiter cette demande automatiquement.
            Essayez avec une description plus prÃ©cise.`;
          
          github.rest.issues.createComment({
            issue_number: issueNumber,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          }); 