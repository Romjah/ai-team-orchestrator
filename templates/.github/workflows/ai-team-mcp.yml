name: AI Team MCP
on:
  issues:
    types: [opened, edited]
  workflow_dispatch:
    inputs:
      task_description:
        description: 'Describe what you want AI Team to build'
        required: true
        default: 'Create a modern landing page'

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  ai-team-mcp:
    runs-on: ubuntu-latest
    name: ğŸ¤– AI Team MCP
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          
      - name: Setup Git
        run: |
          git config --global user.name "AI Team MCP"
          git config --global user.email "ai-team-mcp@github-actions.local"
          
      - name: ğŸ¤– Run AI Team MCP
        id: ai_team
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_TITLE: ${{ github.event.issue.title || github.event.inputs.task_description }}
          ISSUE_BODY: ${{ github.event.issue.body || 'Create modern code' }}
        run: |
          chmod +x .github/scripts/ai_team_mcp.py
          python3 .github/scripts/ai_team_mcp.py
          
      - name: ğŸŒ¿ Create Branch and Push
        if: steps.ai_team.outputs.changes_made == 'true'
        run: |
          BRANCH_NAME="${{ steps.ai_team.outputs.branch_name }}"
          git checkout -b $BRANCH_NAME
          git add -A
          git commit -m "ğŸ¤– ${{ steps.ai_team.outputs.agent }}: ${{ steps.ai_team.outputs.task_summary }}"
          git push origin $BRANCH_NAME
          
      - name: ğŸ”„ Create Pull Request
        if: steps.ai_team.outputs.changes_made == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = '${{ steps.ai_team.outputs.branch_name }}';
            const agent = '${{ steps.ai_team.outputs.agent }}';
            const taskSummary = '${{ steps.ai_team.outputs.task_summary }}';
            const filesCreated = '${{ steps.ai_team.outputs.files_created }}';
            const issueNumber = '${{ github.event.issue.number }}';
            
            const prBody = `ğŸ¤– Pull Request gÃ©nÃ©rÃ©e par AI Team MCP

Agent IA: ${agent}
Issue: ${issueNumber ? '#' + issueNumber : 'Manual task'}

Description: ${taskSummary}
Fichiers crÃ©Ã©s: ${filesCreated}

Technologie: MCP GitHub + AI Team Orchestrator

CrÃ©Ã©e automatiquement par AI Team Orchestrator + MCP GitHub`;
            
            const pr = await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ¤– ${agent}: ${taskSummary}`,
              head: branchName,
              base: 'main',
              body: prBody + (issueNumber ? `\n\nCloses #${issueNumber}` : '')
            });
            
            console.log('PR crÃ©Ã©e:', pr.data.html_url);
            
            if (issueNumber && context.payload.issue) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: parseInt(issueNumber),
                body: `ğŸ‰ Pull Request crÃ©Ã©e avec MCP GitHub !

Agent utilisÃ©: ${agent}
PR crÃ©Ã©e: ${pr.data.html_url}

Prochaines Ã©tapes:
1. Review le code gÃ©nÃ©rÃ© dans la PR
2. Tester les fonctionnalitÃ©s
3. Merger la PR si approuvÃ©

AI Team Orchestrator v1.2.8 + MCP GitHub`
              });
            }
            
      - name: ğŸ’¬ Comment No Changes
        if: steps.ai_team.outputs.changes_made != 'true'
        uses: actions/github-script@v7
        with:
          script: |
            if (context.payload.issue) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `## ğŸ¤– AI Team MCP a analysÃ© votre demande

**Agent assignÃ©:** ${{ steps.ai_team.outputs.agent }}
**TÃ¢che:** ${{ steps.ai_team.outputs.task_summary }}

âš ï¸ **Aucun fichier gÃ©nÃ©rÃ©**

L'agent a analysÃ© mais n'a pas crÃ©Ã© de fichiers.

ğŸ’¡ **Suggestions:**
- Reformulez de maniÃ¨re plus spÃ©cifique
- PrÃ©cisez le type de code souhaitÃ©
- Ajoutez des dÃ©tails techniques

---
*AI Team Orchestrator v1.2.8 avec MCP GitHub*`
              });
            }
            
      - name: ğŸ‰ Summary
        run: |
          echo "ğŸ¤– AI Team MCP completed!"
          echo "Agent: ${{ steps.ai_team.outputs.agent }}"
          echo "Task: ${{ steps.ai_team.outputs.task_summary }}"
          echo "Changes: ${{ steps.ai_team.outputs.changes_made }}" 